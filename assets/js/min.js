$(document).ready(function(){function a(){var a=[];return $(".checkAction").each(function(){$(this).prop("checked")===!0&&a.push($(this).closest("tr").attr("id"))}),a}$("#btnAddFacture, .btnAddFacture").on("dblclick",function(){var a=[];$(".blAFacturer").each(function(){$(this).prop("checked")&&a.push($(this).val())}).promise().done($.post(chemin+"factures/addFacture",{bls:a,clientId:$(this).attr("client"),bdcId:$(this).attr("bdc"),crId:$(this).attr("crId")},function(a){switch(a.type){case"success":window.open(chemin+"factures/ficheFacture/"+a.factureId),window.location.reload();break;case"error":$.toaster({priority:"danger",title:'<strong><i class="glyphicon glyphicon-alert"></i> Oups</strong>',message:"<br>"+a.message})}},"json"))}),$(".btnAffBl").on("click",function(){hold&&hold!==!1?window.open(chemin+"livraisons/ficheBl/"+$(this).text()+"/nonChiffe"):window.open(chemin+"livraisons/ficheBl/"+$(this).text())}),$(document).on("keydown",function(a){27==a.keyCode&&hold===!0&&$("#modalSession").modal("show")}),$("#formLogin").on("submit",function(a){a.preventDefault();var b=$(this).serialize();$.post(chemin+"cx/access",b,function(a){switch(a.type){case"success":window.location.assign(chemin+"ventes");break;case"error":$.toaster({priority:"danger",title:'<strong><i class="glyphicon glyphicon-alert"></i> Oups</strong>',message:"<br>"+a.message})}},"json")}),$(".btnDelDevis").on("dblclick",function(){var a=$(this).closest("tr").attr("id");$.post(chemin+"ventes/delDevis",{devis:a},function(a){"success"==a.type&&window.location.assign(chemin+"ventes/resetDevisEncours")},"json")}),$("#rechClientBdc").on("keyup",function(){$(this).val($(this).val().toUpperCase()),$(".ligneBdc").each(function(){$(this).children("td").eq(1).text().indexOf($("#rechClientBdc").val())>=0?$(this).fadeIn():$(this).fadeOut()})}),$("#rechBdcId").on("keyup",function(){$(this).val($(this).val().toUpperCase()),$(".ligneBdc").each(function(){$(this).children("td").eq(0).text().indexOf($("#rechBdcId").val())>=0?$(this).fadeIn():$(this).fadeOut()})}),$("#btnBdcEnregistrer").on("click",function(){$.post(chemin+"ventes/addBdc",{},function(a){$(".alert").remove(),"success"==a.type?window.location.assign(chemin+"ventes/reloadBdc/"+a.bdc):$("#btnBdcEnregistrer").before('<div class="alert alert-danger">'+a.message+"</div>")},"json")}),$(".ligneBdc").on("click",function(){window.location.assign(chemin+"ventes/reloadBdc/"+$(this).closest("tr").attr("id"))}),$(".btnDelBdc").on("click",function(a){a.stopPropagation()}),$(".btnDelBdc").on("dblclick",function(){var a=$(this).closest("tr").attr("id");$.post(chemin+"ventes/delBdc",{bdc:a},function(a){"success"==a.type&&window.location.assign(chemin+"ventes/bdcListe")},"json")}),$("#btnGenererApproBdc").on("dblclick",function(){commandes=a(),commandes.length>0&&$.post(chemin+"commandes/addApproBdc",{articles:commandes},function(a){"success"==a.type&&window.location.reload()},"json")}),$("#btnGenererManuelBdc").on("dblclick",function(){commandes=a(),commandes.length>0&&$.post(chemin+"commandes/addManuelBdc",{articles:commandes},function(a){"success"==a.type&&window.location.reload()},"json")}),$("#btnGenererStockBdc").on("dblclick",function(){commandes=a(),commandes.length>0&&$.post(chemin+"commandes/addStockBdc",{articles:commandes},function(a){"success"==a.type&&window.location.reload()},"json")}),$(".commandeApproModQte").on("change",function(){$.post(chemin+"commandes/modApproQte",{approId:$(this).attr("cible"),qte:$(this).val()},function(a){"success"==a.type&&window.location.reload()},"json")}),$(".btnCommandeVisualisation").on("click",function(){var a=$(this).attr("cible");$.post(chemin+"commandes/visualisationCommande/"+a,{},function(b){"success"==b.type&&($("#modalCommandeVisualisation .modal-body").text(""),$("#modalCommandeVisualisation .modal-body").prepend(b.message),$("#btnAddCommande").attr("cible",a),$("#modalCommandeVisualisation").modal("show"))},"json")}),$("#btnAddCommande").on("dblclick",function(){$.post(chemin+"commandes/addCommande",{usineId:$(this).attr("cible")},function(a){$("#modalCommandeVisualisation .alert").remove(),"success"==a.type?($("#modalCommandeVisualisation .modal-body").text(""),$("#modalCommandeVisualisation .modal-body").prepend('<div class="alert alert-success">Votre commande a été générée.</div>'),$("#btnAddCommande").fadeOut()):$("#modalCommandeVisualisation .modal-footer").prepend('<div class="alert alert-danger">Erreur lors de l\'envoi. Vérifiez la cohérence de votre commande, votre connexion internet, et rechargez votre page.')},"json")}),$("#modalCommandeVisualisation").on("hidden.bs.modal",function(){window.location.reload()}),$(".ligneCommande").on("click",function(){window.location.assign(chemin+"commandes/ficheCommande/"+$(this).attr("id"))}),$(".formReceptionCommande").on("submit",function(a){a.preventDefault();var b=$(this).serialize();$.post(chemin+"commandes/receptionAppro",b,function(a){"success"==a.type&&window.location.reload()},"json")})});